---
id: 1642
title: Mikrotik dhcp and dhcpv6 relay
date: 2019-03-16T10:11:01-06:00
author: Nick Buraglio
layout: revision
guid: https://www.forwardingplane.net/2019/03/1640-revision-v1/
permalink: /2019/03/1640-revision-v1/
---
When deploying dual stack, dhcpv6 prefix delegation is a crucial piece of the puzzle. While I personally prefer to run the dhcp process on a linux system and relay it for both v4 and v6. 

Assuming you are installing isc-dhcpd, the following configurations can be used to delegate host addresses for both IPv4 and IPv6

 

<pre>#<br /># Sample configuration file for ISC dhcpd for Debian / Ubuntu<br /># Examples provided without support by buraglio@forwardingplane.net<br /># Use at your own risk<br /># https://www.forwardingplane.net<br />#<br /># Attention: If /etc/ltsp/dhcpd.conf exists, that will be used as<br /># configuration file instead of this file.<br />#<br />#<br /><br /># The ddns-updates-style parameter controls whether or not the server will<br /># attempt to do a DNS update when a lease is confirmed. We default to the<br /># behavior of the version 2 packages ('none', since DHCP v2 didn't<br /># have support for DDNS.)<br />ddns-update-style none;<br /><br /><br />default-lease-time 259200;<br />max-lease-time 345600;<br /><br /># If this DHCP server is the official DHCP server for the local<br /># network, the authoritative directive should be uncommented.<br />authoritative;<br /><br /># Use this to send dhcp log messages to a different log file (you also<br /># have to hack syslog.conf to complete the redirection).<br />log-facility local7;<br /><br /># No service will be given on this subnet, but declaring it helps the <br /># DHCP server to understand the network topology. Errors will occur if not set, <br /># but functionality will remain intact<br /><br />#subnet 10.152.187.0 netmask 255.255.255.0 {<br />#}<br /><br /># Primary LAN Scope<br /><br />subnet 10.254.209.0 netmask 255.255.255.192 {<br />range 10.254.209.30 10.254.209.57;<br />option routers 10.254.209.1;<br />#option domain-name-servers resolver.anycast.my-isp.net, resolver2.dc1.my-isp.net;<br />option domain-name-servers resolver.anycast.my-isp.net;<br />#option domain-name-servers 10.254.209.14;<br />option domain-name "dhcp.my-isp.net";<br />}<br /><br /># LAN scope 1<br />subnet 10.254.3.0 netmask 255.255.255.224 {<br />range 10.254.3.10 10.254.3.25;<br />option routers 10.254.3.1;<br />option domain-name-servers resolver.anycast.my-isp.net;<br />option domain-name "dhcp.my-isp.net";<br />}<br /><br /># POP scope 1<br />subnet 10.254.5.0 netmask 255.255.255.224 {<br />range 10.254.5.10 10.254.5.25;<br />option routers 10.254.5.1;<br />option domain-name-servers resolver.anycast.my-isp.net;<br />option domain-name "dhcp.my-isp.net";<br />}<br /><br /># POP Scope 2<br />subnet 10.254.6.0 netmask 255.255.255.224 {<br />range 10.254.6.5 10.254.6.27;<br />option routers 10.254.6.1;<br />option domain-name-servers resolver.anycast.my-isp.net;<br />option domain-name "dhcp.my-isp.net";<br />}<br /><br /># POP Scope 3<br />subnet 10.254.7.0 netmask 255.255.255.224 {<br />range 10.254.7.10 10.254.7.25;<br />option routers 10.254.7.1;<br />#option domain-name-servers resolver1.opendns.com, resolver1.ipv6-sandbox.opendns.com;<br />option domain-name-servers resolver.anycast.my-isp.net;<br />option domain-name "dhcp.my-isp.net";<br />}<br /><br /># POP Scope 4<br />subnet 10.254.4.0 netmask 255.255.255.224 {<br />range 10.254.4.10 10.254.4.25;<br />option routers 10.254.4.1;<br />option domain-name-servers resolver.anycast.my-isp.net;<br />option domain-name "dhcp.my-isp.net";<br />}<br /><br /># POP Scope 5<br />subnet 10.254.8.0 netmask 255.255.255.224 {<br />range 10.254.8.3 10.254.8.30;<br />option routers 10.254.8.1;<br />option domain-name-servers resolver.anycast.my-isp.net;<br />option domain-name "dhcp.my-isp.net";<br />}<br /><br /># POP Scope 6<br />subnet 10.254.9.0 netmask 255.255.255.224 {<br />range 10.254.9.10 10.254.9.25;<br />option routers 10.254.9.1;<br />option domain-name-servers resolver.anycast.my-isp.net;<br />option domain-name "dhcp.my-isp.net";<br />}<br /><br /># Static IPv4 addresses<br /><br />host business-customer1 {<br />hardware ethernet ff:ff:ff:f3:3d:9f;<br />fixed-address 10.254.4.9;<br />}<br /><br />host business-customer2 {<br />hardware ethernet ff:ff:ff:f3:3d:90;<br />fixed-address 10.254.4.11;<br />}<br /><br />host business-customer3 {<br />hardware ethernet ff:ff:ff:f3:3d:9a;<br />fixed-address 10.254.209.5;<br />}<br /><br />host wap1 {<br />hardware ethernet ff:ff:ff:40:d6:b0;<br />fixed-address 10.254.209.4;<br />}<br /><br />host wap2 {<br />hardware ethernet ff:ff:ff:46:76:DC;<br />fixed-address 10.254.209.7;<br />}<br /><br />host wap3 {<br />hardware ethernet ff:ff:ff:1d:d1:6a;<br />fixed-address 10.254.209.3;<br />}<br /><br /><br />For IPv6, this coniguration will provide host addresses to any devices requesting them</pre>

<pre><br />#<br /># Sample configuration file for ISC dhcpd for Debian / Ubuntu<br /># Examples provided without support by buraglio@forwardingplane.net<br /># Use at your own risk<br /># https://www.forwardingplane.net<br />#<br /><br />default-lease-time 600;<br />max-lease-time 7200; <br />log-facility local7; <br />authoritative;<br /><br /><br /># Primary LAN IPv6 Scope<br /><br />option dhcp6.name-servers 2001:db8:f00d::e9::a;<br />option dhcp6.domain-search "dhcp.my-isp.net";<br /><br />option dhcp6.info-refresh-time 21600;<br /><br /># The subnet where the server is attached<br />subnet6 2001:db8:f00d::e9::/64 {<br />range6 2001:db8:f00d::e9:d::2 2001:db8:f00d::e9:d::ffff;<br />}<br /><br /># Other Nets<br /><br /># Primary LAN Scope<br />option dhcp6.name-servers 2001:db8:f00d::e9::a;<br />option dhcp6.domain-search "dhcp.my-isp.net";<br />option dhcp6.info-refresh-time 21600;<br /><br />subnet6 2001:db8:f00d::e0::/64 {<br />range6 2001:db8:f00d::e0:d::2 2001:db8:f00d::e0:d::ffff;<br />}<br /><br /># Pop scope 4<br />option dhcp6.name-servers 2001:db8:f00d::e9::a;<br />option dhcp6.domain-search "dhcp.my-isp.net";<br />option dhcp6.info-refresh-time 21600;<br /><br />subnet6 2001:db8:f00d::e4::/64 {<br />range6 2001:db8:f00d::e4:d::2 2001:db8:f00d::e4:d::ffff;<br />}<br /><br /># Pop Scope 5<br /><br />option dhcp6.name-servers 2001:db8:f00d::e9::a;<br />option dhcp6.domain-search "dhcp.my-isp.net";<br />option dhcp6.info-refresh-time 21600;<br />subnet6 2001:db8:f00d::e8::/64 {<br />range6 2001:db8:f00d::e8:d::2 2001:db8:f00d::e8:d::ffff;<br />}<br /><br /># Pop Scope 2<br />option dhcp6.name-servers 2001:db8:f00d::e9::a;<br />option dhcp6.domain-search "dhcp.my-isp.net";<br />option dhcp6.info-refresh-time 21600;<br />subnet6 2001:db8:f00d::e6::/64 {<br />range6 2001:db8:f00d::e6:d::2 2001:db8:f00d::e6:d::ffff;<br />}<br /><br /># Pop scope 3<br />option dhcp6.name-servers 2001:db8:f00d::e9::a;<br />option dhcp6.domain-search "dhcp.my-isp.net";<br />option dhcp6.info-refresh-time 21600;<br />subnet6 2001:db8:f00d::e7::/64 {<br />range6 2001:db8:f00d::e7:d::2 2001:db8:f00d::e7:d::ffff;<br />}<br /><br /># Fixed host section<br /><br /># this needs fixed<br />#host host1 {<br /># #host-identifier option dhcp6.client-id "\000\000\000\000\000\001\000\001 ;\232\351h[5\204\270\024";<br /># host-identifier option dhcp6.client-id "00010001 203b9ae9 685b3584 b814";<br /># fixed-address6 2001:db8:f00d::e0:0:d::9;<br /># }<br /><br /><br />#}<br /><br /></pre>

This linux configuration can be leveraged by any modern router, below are some of the more common configurations.